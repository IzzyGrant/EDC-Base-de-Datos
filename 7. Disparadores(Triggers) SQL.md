## ‚úÖ Disparadores(Triggers) en SQL:

### ‚ùó Definicion

Un trigger o disparador es un script que se usa en lenguaje de programaci√≥n SQL, en especial en bases de datos como MySQL o
PostgreSQL. Consiste en una serie de reglas predefinidas que se asocian a una tabla. Estas reglas se aplican a la base de datos cuando se realizan
determinadas operaciones en la tabla, por ejemplo, al a√±adir, actualizar o eliminar registros. Dicho de otra manera, el trigger desencadena
determinadas acciones de forma autom√°tica en las tablas de la base de datos cuando se insertan, modifican y se a√±aden nuevos datos. Estos
disparadores se llevan usando en MySQL desde la versi√≥n 5.0.2., mientras que PostgreSQL ya los incluy√≥ en el a√±o 1997.

#### ¬øPara qu√© sirve?

La principal funci√≥n de los trigger es contribuir a mejorar la gesti√≥n de la base de datos. Gracias a ellos muchas operaciones se pueden realizar de
forma autom√°tica, sin necesidad de intervenci√≥n humana, lo que permite ahorrar mucho tiempo. Otra de sus funciones es aumentar la seguridad e
integridad de la informaci√≥n. Esto lo consiguen gracias a la programaci√≥n de restricciones o requerimientos de verificaci√≥n que permiten minimizar los
errores y sincronizar la informaci√≥n.

#### ¬øCu√°ndo se puede usar un Trigger?

Los trigger se puede ejecutar cuando el usuario realizar alguna acci√≥n relacionada con a√±adir, actualizar o eliminar informaci√≥n de una tabla. Es
decir, al usar los comandos INSERT, UPDATE o DELETE. Por tanto, para poder usar un trigger es necesario que el usuario posea permisos INSERT y
DELETE e dicha base de datos.

### ü§î Ejemplo:

Utilizando la tabla en el tema anterior ejemplificaremos un Trigger:

> Schema SQL
```SQL
CREATE TABLE Productos (
  ProductoID INT PRIMARY KEY,
  NombreProducto VARCHAR(50),
  Descripcion VARCHAR(255),
  Precio DECIMAL(10, 2),
  Stock INT
);
INSERT INTO Productos (ProductoID, NombreProducto, Descripcion, Precio, Stock)
VALUES 
  (1, 'Camiseta', 'Camiseta negra simple de talla unica', 10, 16),
  (2, 'Pantalon', 'Pantalon argo azul tipo chino', 20, 24),
  (3, 'Gorra', 'Gorra azul con el logo de los Yankees', 15, 32),
  (4, 'Zapatillas', 'Zapatillas de running de color blanco y verde', 35, 13);
```

#### un ejemplo de trigger que impide que la columna "Stock" en la tabla "Productos" se vuelva negativa:

> Schema SQL (agregar a la parte de abajo)
```SQL
CREATE TRIGGER no_stock_negativo
BEFORE UPDATE ON Productos
FOR EACH ROW
BEGIN
    IF NEW.Stock < 0 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'El stock no puede ser negativo.';
    END IF;
END;

```

En este caso, el trigger se activa antes de cada actualizaci√≥n en la tabla "Productos". El trigger verifica si la nueva cantidad de stock a actualizar es menor que cero (lo que significa que se intentar√° actualizar con un valor negativo) y, en caso afirmativo, genera una excepci√≥n con la instrucci√≥n "SIGNAL" que impide la actualizaci√≥n y muestra un mensaje de error personalizado.

La condici√≥n "BEFORE UPDATE" asegura que se verifique la restricci√≥n de no stock negativo antes de realizar cualquier actualizaci√≥n en la tabla "Productos", evitando as√≠ que se actualice el stock a un valor negativo.

Este es solo un ejemplo de c√≥mo se puede utilizar un trigger para garantizar que se cumplan ciertas restricciones de integridad en una tabla. Es importante tener en cuenta que la implementaci√≥n espec√≠fica de un trigger depender√° del contexto y los requisitos espec√≠ficos del sistema.

#### Probamos el Trigger con un Query SQL valido y otro invalido a partir del Trigger:

> Query SQL Valido ‚úî

```SQL
UPDATE Productos
SET Stock = 40
WHERE ProductoID = 3;
SELECT * from Productos
```


> Query SQL Invalido ‚ùå

```SQL
UPDATE Productos
SET Stock = -32
WHERE ProductoID = 3;
SELECT * from Productos
```

Nos aparecera un mensaje de error como lo definimos:

```CSS
Query Error: Error: ER_SIGNAL_EXCEPTION: El stock no puede ser negativo.
```
